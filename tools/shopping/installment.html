<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分期付款计算 - 生活计算宝典</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="../../layout.css">
    <link rel="stylesheet" href="../../components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="../../favicon.ico" type="image/x-icon">
</head>
<body class="app">
    <header class="app-header">
        <div class="container">
            <nav class="navbar">
                <div class="navbar-mobile">
                    <a href="../../pages/shopping.html" class="navbar-back">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                    <div class="navbar-title">分期付款计算</div>
                    <div></div>
                </div>
                
                <div class="navbar-desktop">
                    <a href="../../index.html" class="logo">
                        <i class="fas fa-calculator"></i>
                        <span class="logo-text">生活计算宝典</span>
                    </a>
                    <div class="nav-links">
                        <a href="../../index.html" class="nav-link">首页</a>
                        <a href="../../pages/shopping.html" class="nav-link active">消费购物</a>
                        <a href="../../pages/finance.html" class="nav-link">理财金融</a>
                        <a href="../../pages/tools.html" class="nav-link">所有工具</a>
                    </div>
                    <div class="theme-toggle">
                        <button class="theme-btn" aria-label="切换主题">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="app-main">
        <section class="section">
            <div class="container">
                <!-- 面包屑导航 -->
                <nav class="breadcrumb">
                    <a href="../../index.html" class="breadcrumb-link">首页</a>
                    <span class="breadcrumb-divider"><i class="fas fa-chevron-right"></i></span>
                    <a href="../../pages/shopping.html" class="breadcrumb-link">消费购物</a>
                    <span class="breadcrumb-divider"><i class="fas fa-chevron-right"></i></span>
                    <span class="breadcrumb-current">分期付款计算</span>
                </nav>
                
                <!-- 计算器容器 -->
                <div class="calculator-container">
                    <div class="calculator-card">
                        <div class="calculator-header">
                            <h1 class="calculator-title">分期付款计算</h1>
                            <p class="calculator-description">
                                计算分期付款的每期金额和总费用，比较不同期数方案，评估分期成本。
                            </p>
                        </div>
                        
                        <!-- 计算方式选择 -->
                        <div class="tabs" id="installmentTabs">
                            <button class="tab active" data-type="equal">等额本息</button>
                            <button class="tab" data-type="equalPrincipal">等额本金</button>
                        </div>
                        
                        <!-- 基础信息 -->
                        <div class="input-group">
                            <label class="input-label">商品总价 (元)</label>
                            <input type="number" id="totalPrice" class="input-field" placeholder="例如：5000" value="5000">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">首付比例 (%)</label>
                            <input type="number" id="downPaymentRate" class="input-field" placeholder="例如：0" value="0" step="0.1" min="0" max="100">
                        </div>
                        
                        <!-- 首付金额显示 -->
                        <div class="input-group">
                            <label class="input-label">首付金额</label>
                            <div class="result-display-small" id="downPaymentAmount">0.00 元</div>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">分期期数</label>
                            <select id="installmentPeriod" class="input-field">
                                <option value="3">3期</option>
                                <option value="6">6期</option>
                                <option value="12" selected>12期</option>
                                <option value="24">24期</option>
                                <option value="36">36期</option>
                            </select>
                        </div>
                        
                        <!-- 费率类型选择 -->
                        <div class="input-group">
                            <label class="input-label">费率类型</label>
                            <div class="rate-type-buttons">
                                <button class="rate-type-btn active" data-type="rate">分期费率</button>
                                <button class="rate-type-btn" data-type="interest">年化利率</button>
                            </div>
                        </div>
                        
                        <!-- 分期费率输入 -->
                        <div id="rateInput">
                            <div class="input-group">
                                <label class="input-label">分期费率 (%)</label>
                                <input type="number" id="installmentRate" class="input-field" placeholder="例如：2.5" value="2.5" step="0.1">
                            </div>
                        </div>
                        
                        <!-- 年化利率输入 -->
                        <div id="interestInput" style="display: none;">
                            <div class="input-group">
                                <label class="input-label">年化利率 (%)</label>
                                <input type="number" id="annualInterestRate" class="input-field" placeholder="例如：10.0" value="10.0" step="0.1">
                            </div>
                        </div>
                        
                        <!-- 手续费收取方式 -->
                        <div class="input-group">
                            <label class="input-label">手续费收取方式</label>
                            <select id="feeType" class="input-field">
                                <option value="first">首期收取</option>
                                <option value="equal" selected>每期平摊</option>
                                <option value="total">一次性收取</option>
                            </select>
                        </div>
                        
                        <!-- 计算按钮 -->
                        <button class="btn btn-primary btn-block calc-btn" id="calculateBtn">
                            <i class="fas fa-calculator"></i> 计算分期
                        </button>
                        
                        <!-- 结果展示 -->
                        <div class="result-display" id="resultSection" style="display: none;">
                            <h3 class="result-title"><i class="fas fa-chart-bar"></i> 分期计算结果</h3>
                            
                            <div id="installmentResult">
                                <div class="result-grid">
                                    <div class="result-item">
                                        <span class="result-label">商品总价</span>
                                        <span class="result-value" id="resultTotalPrice">0.00 元</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">首付金额</span>
                                        <span class="result-value" id="resultDownPayment">0.00 元</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">分期本金</span>
                                        <span class="result-value" id="resultInstallmentPrincipal">0.00 元</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">手续费/利息</span>
                                        <span class="result-value" id="resultTotalFee">0.00 元</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">总还款额</span>
                                        <span class="result-value" id="resultTotalRepayment">0.00 元</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="result-label">每期还款</span>
                                        <span class="result-value" id="resultMonthlyPayment">0.00 元</span>
                                    </div>
                                </div>
                                
                                <!-- 分期明细表格 -->
                                <div style="margin-top: 1.5rem;">
                                    <h4 class="result-title" style="font-size: 1rem;">分期明细</h4>
                                    <div class="installment-table-container">
                                        <table class="installment-table" id="installmentTable">
                                            <thead>
                                                <tr>
                                                    <th>期数</th>
                                                    <th>还款日期</th>
                                                    <th>应还本金</th>
                                                    <th>手续费/利息</th>
                                                    <th>当期总额</th>
                                                    <th>剩余本金</th>
                                                </tr>
                                            </thead>
                                            <tbody id="installmentTableBody">
                                                <!-- 分期明细将动态生成 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- 成本分析 -->
                                <div style="margin-top: 1.5rem;">
                                    <h4 class="result-title" style="font-size: 1rem;">成本分析</h4>
                                    <div class="result-grid">
                                        <div class="result-item">
                                            <span class="result-label">实际年化利率</span>
                                            <span class="result-value" id="resultActualAPR">0.00%</span>
                                        </div>
                                        <div class="result-item">
                                            <span class="result-label">分期费率</span>
                                            <span class="result-value" id="resultInstallmentRate">0.00%</span>
                                        </div>
                                        <div class="result-item">
                                            <span class="result-label">成本占比</span>
                                            <span class="result-value" id="resultCostRatio">0.00%</span>
                                        </div>
                                        <div class="result-item">
                                            <span class="result-label">分期建议</span>
                                            <span class="result-value" id="resultSuggestion">建议分期</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 不同期数对比 -->
                    <div class="comparison-section mt-6">
                        <h3 class="section-title" style="font-size: 1.25rem; text-align: center; margin-bottom: 1rem;">
                            <i class="fas fa-balance-scale"></i> 不同期数对比
                        </h3>
                        <div class="comparison-grid" id="periodComparison">
                            <!-- 不同期数对比将动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 分期注意事项 -->
                    <div class="alert alert-warning mt-6">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle mr-3"></i>
                            <div>
                                <strong>分期注意事项：</strong> 
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    <li><strong>实际利率</strong>：分期手续费率不等于实际年化利率，实际利率通常更高</li>
                                    <li><strong>提前还款</strong>：部分分期产品提前还款仍需支付全部手续费</li>
                                    <li><strong>逾期费用</strong>：逾期会产生额外罚息，影响个人信用</li>
                                    <li><strong>免息分期</strong>：注意区分"免息"和"免手续费"，两者不同</li>
                                    <li><strong>理性消费</strong>：分期虽减轻当期压力，但会增加总支出</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 使用说明 -->
                    <div class="alert alert-info mt-6">
                        <div class="flex items-center">
                            <i class="fas fa-lightbulb mr-3"></i>
                            <div>
                                <strong>如何使用：</strong> 
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    <li><strong>等额本息</strong>：每期还款金额相同，适合预算固定的消费者</li>
                                    <li><strong>等额本金</strong>：每期还款本金相同，利息逐期递减，前期压力较大</li>
                                    <li><strong>费率类型</strong>：选择分期费率或年化利率，系统会自动换算</li>
                                    <li><strong>手续费收取</strong>：不同收取方式会影响实际成本</li>
                                    <li><strong>期数对比</strong>：查看不同期数下的还款金额和总成本</li>
                                    <li><strong>自动计算</strong>：每次输入后自动更新计算结果</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <a href="../../index.html" class="footer-logo">
                        <i class="fas fa-calculator"></i>
                        <span>生活计算宝典</span>
                    </a>
                    <p class="footer-description">
                        一站式离线计算工具集合，为您的生活带来便利。
                    </p>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">购物工具</h4>
                    <a href="discount.html" class="footer-link">折扣计算器</a>
                    <a href="member-discount.html" class="footer-link">会员折扣计算</a>
                    <a href="coupon.html" class="footer-link">优惠券计算</a>
                    <a href="installment.html" class="footer-link">分期付款计算</a>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">快速链接</h4>
                    <a href="../../pages/shopping.html" class="footer-link">返回消费购物</a>
                    <a href="../../pages/tools.html" class="footer-link">所有工具</a>
                    <a href="https://github.com/laddzhao/life-calculators" target="_blank" class="footer-link">GitHub项目</a>
                    <a href="../../404.html" class="footer-link">404页面</a>
                </div>
                
                <div class="footer-section">
                    <h4 class="footer-heading">其他工具</h4>
                    <a href="../home/utility-bill.html" class="footer-link">水电费计算</a>
                    <a href="../finance/compound.html" class="footer-link">复利计算器</a>
                    <a href="../health/bmi.html" class="footer-link">BMI计算</a>
                    <a href="../professional/mortgage.html" class="footer-link">房贷计算器</a>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 生活计算宝典 · 分期付款计算</p>
            </div>
        </div>
    </footer>

    <!-- 移动端底部导航 -->
    <nav class="mobile-bottom-nav">
        <a href="../../index.html" class="nav-item">
            <i class="fas fa-home nav-icon"></i>
            <span class="nav-label">首页</span>
        </a>
        <a href="../../pages/shopping.html" class="nav-item active">
            <i class="fas fa-shopping-cart nav-icon"></i>
            <span class="nav-label">购物</span>
        </a>
        <a href="../../pages/finance.html" class="nav-item">
            <i class="fas fa-chart-line nav-icon"></i>
            <span class="nav-label">理财</span>
        </a>
        <a href="../../pages/tools.html" class="nav-item">
            <i class="fas fa-th nav-icon"></i>
            <span class="nav-label">全部</span>
        </a>
        <a href="#" class="nav-item" id="mobileMenuBtn">
            <i class="fas fa-ellipsis-h nav-icon"></i>
            <span class="nav-label">更多</span>
        </a>
    </nav>

    <script>
        // 标签页切换
        document.querySelectorAll('#installmentTabs .tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // 移除所有active类
                document.querySelectorAll('#installmentTabs .tab').forEach(t => {
                    t.classList.remove('active');
                });
                
                // 添加active类到当前标签
                this.classList.add('active');
                
                // 重新计算
                setTimeout(() => {
                    calculateInstallment();
                }, 100);
            });
        });
        
        // 费率类型切换
        document.querySelectorAll('.rate-type-btn').forEach(button => {
            button.addEventListener('click', function() {
                // 移除所有active类
                document.querySelectorAll('.rate-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // 添加active类到当前按钮
                this.classList.add('active');
                
                const type = this.dataset.type;
                
                // 显示对应的输入区域
                document.getElementById('rateInput').style.display = type === 'rate' ? 'block' : 'none';
                document.getElementById('interestInput').style.display = type === 'interest' ? 'block' : 'none';
                
                // 重新计算
                setTimeout(() => {
                    calculateInstallment();
                }, 100);
            });
        });
        
        // 输入框变化时自动计算
        document.querySelectorAll('#totalPrice, #downPaymentRate, #installmentRate, #annualInterestRate').forEach(input => {
            input.addEventListener('input', calculateInstallment);
        });
        
        // 下拉框变化时自动计算
        document.getElementById('installmentPeriod').addEventListener('change', calculateInstallment);
        document.getElementById('feeType').addEventListener('change', calculateInstallment);
        
        // 计算分期付款
        function calculateInstallment() {
            // 获取输入值
            const totalPrice = parseFloat(document.getElementById('totalPrice').value) || 0;
            const downPaymentRate = parseFloat(document.getElementById('downPaymentRate').value) || 0;
            const period = parseInt(document.getElementById('installmentPeriod').value) || 12;
            const feeType = document.getElementById('feeType').value;
            const activeTab = document.querySelector('#installmentTabs .tab.active').dataset.type;
            const rateType = document.querySelector('.rate-type-btn.active').dataset.type;
            
            // 计算首付金额
            const downPayment = totalPrice * (downPaymentRate / 100);
            const principal = totalPrice - downPayment; // 分期本金
            
            // 计算分期费率
            let installmentRate = 0;
            let annualRate = 0;
            
            if (rateType === 'rate') {
                // 分期费率
                installmentRate = parseFloat(document.getElementById('installmentRate').value) || 0;
                // 近似计算年化利率（简化计算）
                annualRate = installmentRate * 24 / (period + 1);
            } else {
                // 年化利率
                annualRate = parseFloat(document.getElementById('annualInterestRate').value) || 0;
                // 近似计算分期费率（简化计算）
                installmentRate = annualRate * (period + 1) / 24;
            }
            
            // 计算总手续费/利息
            let totalFee = 0;
            let monthlyPayment = 0;
            let installmentDetails = [];
            
            if (activeTab === 'equal') {
                // 等额本息计算
                totalFee = principal * (installmentRate / 100);
                
                if (feeType === 'first') {
                    // 首期收取手续费
                    monthlyPayment = principal / period;
                    const firstPayment = monthlyPayment + totalFee;
                    
                    for (let i = 1; i <= period; i++) {
                        const principalPayment = monthlyPayment;
                        const interestPayment = i === 1 ? totalFee : 0;
                        const totalPayment = i === 1 ? firstPayment : monthlyPayment;
                        const remainingPrincipal = Math.max(0, principal - (i * principalPayment));
                        
                        installmentDetails.push({
                            period: i,
                            principal: principalPayment,
                            interest: interestPayment,
                            total: totalPayment,
                            remaining: remainingPrincipal
                        });
                    }
                } else if (feeType === 'equal') {
                    // 每期平摊手续费
                    monthlyPayment = (principal + totalFee) / period;
                    const interestPerPeriod = totalFee / period;
                    const principalPerPeriod = principal / period;
                    
                    for (let i = 1; i <= period; i++) {
                        const principalPayment = principalPerPeriod;
                        const interestPayment = interestPerPeriod;
                        const totalPayment = monthlyPayment;
                        const remainingPrincipal = Math.max(0, principal - (i * principalPerPeriod));
                        
                        installmentDetails.push({
                            period: i,
                            principal: principalPayment,
                            interest: interestPayment,
                            total: totalPayment,
                            remaining: remainingPrincipal
                        });
                    }
                } else if (feeType === 'total') {
                    // 一次性收取手续费（通常在首期或单独收取）
                    monthlyPayment = principal / period;
                    totalFee = principal * (installmentRate / 100);
                    
                    for (let i = 1; i <= period; i++) {
                        const principalPayment = monthlyPayment;
                        const interestPayment = 0; // 手续费单独计算
                        const totalPayment = monthlyPayment;
                        const remainingPrincipal = Math.max(0, principal - (i * principalPayment));
                        
                        installmentDetails.push({
                            period: i,
                            principal: principalPayment,
                            interest: interestPayment,
                            total: totalPayment,
                            remaining: remainingPrincipal
                        });
                    }
                }
            } else {
                // 等额本金计算
                const principalPerPeriod = principal / period;
                
                if (feeType === 'first') {
                    // 首期收取手续费
                    totalFee = principal * (installmentRate / 100);
                    
                    for (let i = 1; i <= period; i++) {
                        const principalPayment = principalPerPeriod;
                        const remainingPrincipalBefore = Math.max(0, principal - ((i - 1) * principalPerPeriod));
                        const interestPayment = i === 1 ? totalFee : 0;
                        const totalPayment = principalPayment + (i === 1 ? totalFee : 0);
                        const remainingPrincipal = Math.max(0, remainingPrincipalBefore - principalPayment);
                        
                        installmentDetails.push({
                            period: i,
                            principal: principalPayment,
                            interest: interestPayment,
                            total: totalPayment,
                            remaining: remainingPrincipal
                        });
                    }
                } else if (feeType === 'equal') {
                    // 每期平摊手续费
                    totalFee = principal * (installmentRate / 100);
                    const interestPerPeriod = totalFee / period;
                    
                    for (let i = 1; i <= period; i++) {
                        const principalPayment = principalPerPeriod;
                        const interestPayment = interestPerPeriod;
                        const totalPayment = principalPayment + interestPayment;
                        const remainingPrincipal = Math.max(0, principal - (i * principalPerPeriod));
                        
                        installmentDetails.push({
                            period: i,
                            principal: principalPayment,
                            interest: interestPayment,
                            total: totalPayment,
                            remaining: remainingPrincipal
                        });
                    }
                } else if (feeType === 'total') {
                    // 一次性收取手续费
                    totalFee = principal * (installmentRate / 100);
                    
                    for (let i = 1; i <= period; i++) {
                        const principalPayment = principalPerPeriod;
                        const interestPayment = 0;
                        const totalPayment = principalPayment;
                        const remainingPrincipal = Math.max(0, principal - (i * principalPerPeriod));
                        
                        installmentDetails.push({
                            period: i,
                            principal: principalPayment,
                            interest: interestPayment,
                            total: totalPayment,
                            remaining: remainingPrincipal
                        });
                    }
                }
                
                // 等额本金的每期还款不同，取第一期作为参考
                monthlyPayment = installmentDetails.length > 0 ? installmentDetails[0].total : 0;
            }
            
            // 计算总还款额
            const totalRepayment = downPayment + principal + totalFee;
            
            // 计算成本占比
            const costRatio = totalPrice > 0 ? (totalFee / totalPrice * 100) : 0;
            
            // 显示基础结果
            document.getElementById('downPaymentAmount').textContent = downPayment.toFixed(2) + ' 元';
            document.getElementById('resultTotalPrice').textContent = totalPrice.toFixed(2) + ' 元';
            document.getElementById('resultDownPayment').textContent = downPayment.toFixed(2) + ' 元';
            document.getElementById('resultInstallmentPrincipal').textContent = principal.toFixed(2) + ' 元';
            document.getElementById('resultTotalFee').textContent = totalFee.toFixed(2) + ' 元';
            document.getElementById('resultTotalRepayment').textContent = totalRepayment.toFixed(2) + ' 元';
            document.getElementById('resultMonthlyPayment').textContent = monthlyPayment.toFixed(2) + ' 元';
            document.getElementById('resultActualAPR').textContent = annualRate.toFixed(2) + '%';
            document.getElementById('resultInstallmentRate').textContent = installmentRate.toFixed(2) + '%';
            document.getElementById('resultCostRatio').textContent = costRatio.toFixed(2) + '%';
            
            // 分期建议
            let suggestion = '建议分期';
            if (costRatio > 10) {
                suggestion = '成本较高';
            } else if (costRatio < 3) {
                suggestion = '成本较低';
            }
            document.getElementById('resultSuggestion').textContent = suggestion;
            document.getElementById('resultSuggestion').style.color = 
                suggestion === '成本较高' ? 'var(--danger)' : 
                suggestion === '成本较低' ? 'var(--success)' : 'var(--primary)';
            
            // 显示分期明细表格
            displayInstallmentTable(installmentDetails, feeType);
            
            // 显示不同期数对比
            displayPeriodComparison(totalPrice, downPaymentRate, feeType, activeTab, rateType);
            
            // 显示结果区域
            document.getElementById('resultSection').style.display = 'block';
        }
        
        // 显示分期明细表格
        function displayInstallmentTable(details, feeType) {
            const tableBody = document.getElementById('installmentTableBody');
            tableBody.innerHTML = '';
            
            // 如果是手续费一次性收取，在表格上方显示
            if (feeType === 'total') {
                const totalFee = details.reduce((sum, item) => sum + item.interest, 0);
                const principal = details.reduce((sum, item) => sum + item.principal, 0);
                const totalFeeAmount = principal * (parseFloat(document.getElementById('installmentRate').value) || 0) / 100;
                
                const noteRow = document.createElement('tr');
                noteRow.className = 'table-note';
                noteRow.innerHTML = `
                    <td colspan="6">
                        <i class="fas fa-info-circle"></i> 
                        手续费${totalFeeAmount.toFixed(2)}元一次性收取，未包含在分期还款中
                    </td>
                `;
                tableBody.appendChild(noteRow);
            }
            
            // 添加分期明细行
            details.forEach(item => {
                const row = document.createElement('tr');
                
                // 计算还款日期（简单模拟，当前日期 + 期数个月）
                const currentDate = new Date();
                currentDate.setMonth(currentDate.getMonth() + item.period);
                const paymentDate = currentDate.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                
                row.innerHTML = `
                    <td>第${item.period}期</td>
                    <td>${paymentDate}</td>
                    <td>${item.principal.toFixed(2)}</td>
                    <td>${item.interest.toFixed(2)}</td>
                    <td>${item.total.toFixed(2)}</td>
                    <td>${item.remaining.toFixed(2)}</td>
                `;
                
                // 如果是第一期且手续费首期收取，高亮显示
                if (item.period === 1 && item.interest > 0 && feeType === 'first') {
                    row.classList.add('first-period');
                }
                
                tableBody.appendChild(row);
            });
        }
        
        // 显示不同期数对比
        function displayPeriodComparison(totalPrice, downPaymentRate, feeType, activeTab, rateType) {
            const comparisonGrid = document.getElementById('periodComparison');
            const periods = [3, 6, 12, 24, 36];
            
            let html = '';
            
            periods.forEach(period => {
                const downPayment = totalPrice * (downPaymentRate / 100);
                const principal = totalPrice - downPayment;
                
                // 获取费率
                let installmentRate = 0;
                if (rateType === 'rate') {
                    installmentRate = parseFloat(document.getElementById('installmentRate').value) || 0;
                } else {
                    const annualRate = parseFloat(document.getElementById('annualInterestRate').value) || 0;
                    installmentRate = annualRate * (period + 1) / 24;
                }
                
                // 计算总手续费
                const totalFee = principal * (installmentRate / 100);
                
                // 计算每期还款
                let monthlyPayment = 0;
                if (activeTab === 'equal') {
                    if (feeType === 'first') {
                        monthlyPayment = principal / period;
                    } else if (feeType === 'equal') {
                        monthlyPayment = (principal + totalFee) / period;
                    } else {
                        monthlyPayment = principal / period;
                    }
                } else {
                    // 等额本金，取第一期作为参考
                    const principalPerPeriod = principal / period;
                    if (feeType === 'first') {
                        monthlyPayment = principalPerPeriod + (period === 1 ? totalFee : 0);
                    } else if (feeType === 'equal') {
                        monthlyPayment = principalPerPeriod + (totalFee / period);
                    } else {
                        monthlyPayment = principalPerPeriod;
                    }
                }
                
                const totalRepayment = downPayment + principal + totalFee;
                const costRatio = totalPrice > 0 ? (totalFee / totalPrice * 100) : 0;
                
                html += `
                    <div class="comparison-item ${period === 12 ? 'recommended' : ''}">
                        <div class="comparison-period">${period}期</div>
                        <div class="comparison-details">
                            <div class="comparison-row">
                                <span>每期还款</span>
                                <span class="comparison-value">${monthlyPayment.toFixed(2)}元</span>
                            </div>
                            <div class="comparison-row">
                                <span>总手续费</span>
                                <span class="comparison-value">${totalFee.toFixed(2)}元</span>
                            </div>
                            <div class="comparison-row">
                                <span>总还款额</span>
                                <span class="comparison-value">${totalRepayment.toFixed(2)}元</span>
                            </div>
                            <div class="comparison-row">
                                <span>成本占比</span>
                                <span class="comparison-value">${costRatio.toFixed(2)}%</span>
                            </div>
                        </div>
                        ${period === 12 ? '<div class="recommend-badge">推荐</div>' : ''}
                    </div>
                `;
            });
            
            comparisonGrid.innerHTML = html;
        }
        
        // 主题切换
        function initTheme() {
            const themeBtn = document.querySelector('.theme-btn');
            
            // 检查本地存储的主题设置
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            
            // 切换主题函数
            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // 更新图标
                if (themeBtn) {
                    const icon = themeBtn.querySelector('i');
                    icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                }
            }
            
            // 添加事件监听
            if (themeBtn) themeBtn.addEventListener('click', toggleTheme);
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            
            // 页面加载时自动计算一次
            calculateInstallment();
            
            // 移动端菜单
            const menuBtn = document.getElementById('mobileMenuBtn');
            if (menuBtn) {
                menuBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    alert('移动端菜单功能需要完整的菜单HTML结构');
                });
            }
        });
    </script>
    
    <style>
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-decoration: none;
            border: none;
            background: none;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .tab:hover {
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .result-display-small {
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border-light);
            font-weight: 600;
            color: var(--primary);
        }
        
        .rate-type-buttons {
            display: flex;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }
        
        .rate-type-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .rate-type-btn:hover {
            background: var(--bg-tertiary);
        }
        
        .rate-type-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .installment-table-container {
            overflow-x: auto;
            margin-top: 0.5rem;
        }
        
        .installment-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        
        .installment-table th {
            background: var(--bg-secondary);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-light);
        }
        
        .installment-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-light);
        }
        
        .installment-table tr:hover {
            background: var(--bg-secondary);
        }
        
        .installment-table .table-note {
            background: var(--warning-light);
            color: var(--warning);
        }
        
        .installment-table .first-period {
            background: var(--primary-light);
        }
        
        .comparison-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--border-light);
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        @media (min-width: 768px) {
            .comparison-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        .comparison-item {
            position: relative;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: var(--radius);
            border: 1px solid var(--border-light);
        }
        
        .comparison-item.recommended {
            border: 2px solid var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .comparison-period {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-light);
        }
        
        .comparison-details {
            font-size: 0.875rem;
        }
        
        .comparison-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .comparison-row:last-child {
            margin-bottom: 0;
        }
        
        .comparison-value {
            font-weight: 600;
            color: var(--primary);
        }
        
        .recommend-badge {
            position: absolute;
            top: -0.5rem;
            right: -0.5rem;
            background: var(--primary);
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
        }
        
        @media (max-width: 640px) {
            .tabs {
                font-size: 0.875rem;
            }
            
            .tab {
                padding: 0.5rem 1rem;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .installment-table {
                font-size: 0.75rem;
            }
            
            .installment-table th,
            .installment-table td {
                padding: 0.5rem;
            }
        }
    </style>
</body>
</html>